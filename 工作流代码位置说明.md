# å·¥ä½œæµå„é˜¶æ®µå‚æ•°å’Œä»£ç ä½ç½®è¯´æ˜

## ğŸ“ ä»£ç ä½ç½®æ€»è§ˆ

### åç«¯ä»£ç 
1. **APIç«¯ç‚¹**ï¼š`app/api/v1/endpoints/workflow.py`
   - `execute_workflow()` - éæµå¼æ‰§è¡Œï¼ˆç¬¬31-438è¡Œï¼‰
   - `execute_workflow_stream()` - æµå¼æ‰§è¡Œï¼ˆç¬¬441-1108è¡Œï¼‰

2. **å·¥ä½œæµå®ç°**ï¼š`app/core/workflows/paper_generation_workflow.py`
   - `execute()` - éæµå¼æ‰§è¡Œï¼ˆç¬¬27-419è¡Œï¼‰
   - `execute_stream()` - æµå¼æ‰§è¡Œï¼ˆç¬¬421-989è¡Œï¼‰

### å‰ç«¯ä»£ç 
1. **APIæœåŠ¡**ï¼š`frontend/src/services/api.ts`
   - `workflowApi.execute()` - éæµå¼è°ƒç”¨ï¼ˆç¬¬340-397è¡Œï¼‰
   - `workflowApi.executeStream()` - æµå¼è°ƒç”¨ï¼ˆç¬¬400-515è¡Œï¼‰

2. **å·¥ä½œæµç»„ä»¶**ï¼š`frontend/src/components/Workflow.tsx`
   - `handleSubmit()` - è¡¨å•æäº¤å¤„ç†ï¼ˆç¬¬723-890è¡Œï¼‰

---

## ğŸ”„ æ­¥éª¤0: ç”¨æˆ·è¾“å…¥ä¸PDF/å›¾ç‰‡å¤„ç†

### åç«¯å¤„ç†ä½ç½®
**æ–‡ä»¶**ï¼š`app/api/v1/endpoints/workflow.py`

#### éæµå¼ç‰ˆæœ¬ï¼ˆ`execute_workflow`ï¼‰
- **PDFå¤„ç†**ï¼šç¬¬91-247è¡Œ
- **å›¾ç‰‡å¤„ç†**ï¼šç¬¬249-354è¡Œ
- **å†…å®¹åˆå¹¶**ï¼šç¬¬356-368è¡Œ

#### æµå¼ç‰ˆæœ¬ï¼ˆ`execute_workflow_stream`ï¼‰
- **PDFå¤„ç†**ï¼šç¬¬650-774è¡Œ
- **å›¾ç‰‡å¤„ç†**ï¼šç¬¬776-922è¡Œ
- **å†…å®¹åˆå¹¶**ï¼šç¬¬924-945è¡Œ

### è¾“å…¥å‚æ•°ï¼ˆAPIç«¯ç‚¹æ¥æ”¶ï¼‰

| å‚æ•° | ç±»å‹ | ä½ç½® | è¯´æ˜ |
|------|------|------|------|
| `document` | `str` | Formå‚æ•° | ç”¨æˆ·æä¾›çš„æ–‡å­—æè¿°ï¼ˆå¯é€‰ï¼‰ |
| `pdf_file` | `UploadFile` | Fileå‚æ•° | ç”¨æˆ·ä¸Šä¼ çš„PDFæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ |
| `image_files` | `List[UploadFile]` | Fileå‚æ•° | ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæ”¯æŒå¤šå¼ ï¼‰ |
| `session_id` | `str` | Formå‚æ•° | å¯é€‰çš„ session ID |
| `user_info` | `str` | Formå‚æ•° | ç”¨æˆ·æä¾›çš„é¢å¤–ä¿¡æ¯ |
| `has_outline` | `bool` | Formå‚æ•° | ç”¨æˆ·æ˜¯å¦æä¾›äº†è®ºæ–‡å¤§çº²ï¼ˆé»˜è®¤: falseï¼‰ |
| `has_existing_tex` | `bool` | Formå‚æ•° | æ˜¯å¦å­˜åœ¨ç°æœ‰çš„ .tex æ–‡ä»¶ï¼ˆé»˜è®¤: falseï¼‰ |
| `temperature` | `float` | Formå‚æ•° | æ¸©åº¦å‚æ•°ï¼ˆå¯é€‰ï¼‰ |
| `max_tokens` | `int` | Formå‚æ•° | æœ€å¤§tokenæ•°ï¼ˆå¯é€‰ï¼‰ |
| `model` | `str` | Formå‚æ•° | æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼‰ |

### å¤„ç†æµç¨‹

1. **PDFå¤„ç†**ï¼ˆå¦‚æœä¸Šä¼ äº†PDFï¼‰ï¼š
   ```python
   # ä½ç½®ï¼šworkflow.py ç¬¬91-247è¡Œï¼ˆéæµå¼ï¼‰æˆ– ç¬¬650-774è¡Œï¼ˆæµå¼ï¼‰
   - PDFéªŒè¯ï¼ˆæ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼‰
   - PDFè½¬PNGï¼ˆä½¿ç”¨ pdf_to_pngsï¼ŒDPI: 300ï¼‰
   - Vision Agentæå–æ–‡å­—ï¼ˆå¹¶å‘å¤„ç†æ‰€æœ‰é¡µé¢ï¼‰
   - æ‹¼æ¥æ‰€æœ‰é¡µé¢çš„æ–‡å­—å†…å®¹
   ```

2. **å›¾ç‰‡å¤„ç†**ï¼ˆå¦‚æœä¸Šä¼ äº†å›¾ç‰‡ï¼‰ï¼š
   ```python
   # ä½ç½®ï¼šworkflow.py ç¬¬249-354è¡Œï¼ˆéæµå¼ï¼‰æˆ– ç¬¬776-922è¡Œï¼ˆæµå¼ï¼‰
   - å›¾ç‰‡éªŒè¯ï¼ˆæ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼‰
   - ä¿å­˜å›¾ç‰‡åˆ° session/uploaded/
   - Vision Agentæå–æ–‡å­—ï¼ˆå¹¶å‘å¤„ç†æ‰€æœ‰å›¾ç‰‡ï¼‰
   - æ‹¼æ¥æ‰€æœ‰å›¾ç‰‡çš„æ–‡å­—å†…å®¹ï¼Œæ·»åŠ æ ‡è¯†
   ```

3. **å†…å®¹åˆå¹¶**ï¼š
   ```python
   # ä½ç½®ï¼šworkflow.py ç¬¬356-368è¡Œï¼ˆéæµå¼ï¼‰æˆ– ç¬¬924-945è¡Œï¼ˆæµå¼ï¼‰
   combined_document = document + PDFæ–‡å­— + å›¾ç‰‡æ–‡å­—
   ```

### è¾“å‡º
- `combined_document`: åˆå¹¶åçš„æ–‡æ¡£å†…å®¹
- `pdf_file_path`: PDFæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼ˆå¦‚æœæœ‰ï¼‰
- `image_file_paths`: å›¾ç‰‡æ–‡ä»¶ä¿å­˜è·¯å¾„åˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰

---

## ğŸ“ æ­¥éª¤1: Paper Overview Agent

### åç«¯å¤„ç†ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/workflows/paper_generation_workflow.py`

#### éæµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬154-204è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.paper_overview_agent.generate_overview()`

#### æµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬571-653è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.paper_overview_agent.generate_overview()`

### è¾“å…¥å‚æ•°

| å‚æ•° | ç±»å‹ | æ¥æº | è¯´æ˜ |
|------|------|------|------|
| `user_document` | `str` | æ­¥éª¤0è¾“å‡º | åˆå¹¶åçš„æ–‡æ¡£å†…å®¹ï¼ˆ`combined_document`ï¼‰ |
| `temperature` | `float` | APIå‚æ•° | æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤: 0.7ï¼‰ |
| `max_tokens` | `int` | APIå‚æ•° | æœ€å¤§tokenæ•°ï¼ˆé»˜è®¤: 4000ï¼‰ |
| `model` | `str` | APIå‚æ•° | æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼‰ |

### è¾“å‡º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `file_name` | `str` | æ–‡ä»¶åï¼Œæ ¼å¼ï¼š`[Paper_Title]_[Paper_Type]_paper_overview.txt` |
| `file_content` | `str` | æ–‡ä»¶å†…å®¹ï¼ˆçº¯æ–‡æœ¬ï¼‰ |
| `usage` | `dict` | Tokenä½¿ç”¨æƒ…å†µ |

### Agentå®ç°ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/agents/paper_overview_agent.py`
- `generate_overview()` æ–¹æ³•

---

## ğŸ“„ æ­¥éª¤2: LaTeX Paper Generator Agent

### åç«¯å¤„ç†ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/workflows/paper_generation_workflow.py`

#### éæµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬206-332è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.latex_paper_agent.generate_latex_paper()`

#### æµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬655-855è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.latex_paper_agent.generate_latex_paper_stream()`

### è¾“å…¥å‚æ•°

| å‚æ•° | ç±»å‹ | æ¥æº | è¯´æ˜ |
|------|------|------|------|
| `paper_overview` | `str` | æ­¥éª¤1è¾“å‡º | è®ºæ–‡æ¦‚è§ˆæ–‡ä»¶å†…å®¹ |
| `user_document` | `str` | æ­¥éª¤0è¾“å‡º | ä»æ­¥éª¤0å¾—åˆ°çš„åˆå¹¶æ–‡æ¡£å†…å®¹ï¼ˆ`combined_document`ï¼‰ |
| `user_info` | `str` | APIå‚æ•° | ç”¨æˆ·æä¾›çš„é¢å¤–ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ |
| `has_outline` | `bool` | APIå‚æ•° | ç”¨æˆ·æ˜¯å¦æä¾›äº†è®ºæ–‡å¤§çº²ï¼ˆå¦‚æœä¸º trueï¼Œä¼šè·³è¿‡ç”Ÿæˆï¼‰ |
| `has_existing_tex` | `bool` | APIå‚æ•° | æ˜¯å¦å­˜åœ¨ç°æœ‰çš„ .tex æ–‡ä»¶ï¼ˆå¦‚æœä¸º trueï¼Œä¼šè·³è¿‡ç”Ÿæˆï¼‰ |
| `temperature` | `float` | APIå‚æ•° | æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤: 0.7ï¼‰ |
| `max_tokens` | `int` | APIå‚æ•° | æœ€å¤§tokenæ•°ï¼ˆé»˜è®¤: 16000ï¼‰ |
| `model` | `str` | APIå‚æ•° | æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼‰ |

### è¾“å‡º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `file_name` | `str` or `None` | æ–‡ä»¶åï¼ˆå¦‚æœè·³è¿‡åˆ™ä¸º Noneï¼‰ï¼Œé€šå¸¸ä¸º `paper_framework.tex` |
| `file_content` | `str` or `None` | LaTeX æ–‡ä»¶å†…å®¹ï¼ˆå¦‚æœè·³è¿‡åˆ™ä¸º Noneï¼‰ |
| `is_skipped` | `bool` | æ˜¯å¦è·³è¿‡äº†ç”Ÿæˆ |
| `skip_reason` | `str` or `None` | è·³è¿‡åŸå›  |
| `usage` | `dict` | Tokenä½¿ç”¨æƒ…å†µ |

### è·³è¿‡æ¡ä»¶æ£€æŸ¥
**ä½ç½®**ï¼š`paper_generation_workflow.py` ç¬¬125-139è¡Œï¼ˆéæµå¼ï¼‰æˆ– ç¬¬538-556è¡Œï¼ˆæµå¼ï¼‰

```python
# æ£€æŸ¥æ˜¯å¦å­˜åœ¨ .tex æ–‡ä»¶
if not has_existing_tex:
    tex_files = list(session_folder.glob("*.tex"))
    # ... æ£€æŸ¥ uploaded å’Œ generated å­æ–‡ä»¶å¤¹
    if tex_files:
        has_existing_tex = True
```

### Agentå®ç°ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/agents/latex_paper_generator_agent.py`
- `generate_latex_paper()` æ–¹æ³•ï¼ˆéæµå¼ï¼‰
- `generate_latex_paper_stream()` æ–¹æ³•ï¼ˆæµå¼ï¼‰

---

## âœ… æ­¥éª¤3: Requirement Checklist Agent

### åç«¯å¤„ç†ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/workflows/paper_generation_workflow.py`

#### éæµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬334-411è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.requirement_checklist_agent.generate_requirement_checklist()`

#### æµå¼ç‰ˆæœ¬
- **è°ƒç”¨ä½ç½®**ï¼šç¬¬857-956è¡Œ
- **Agentè°ƒç”¨**ï¼š`self.requirement_checklist_agent.generate_requirement_checklist()`

### è¾“å…¥å‚æ•°

| å‚æ•° | ç±»å‹ | æ¥æº | è¯´æ˜ |
|------|------|------|------|
| `paper_overview` | `str` | æ­¥éª¤1è¾“å‡º | è®ºæ–‡æ¦‚è§ˆæ–‡ä»¶å†…å®¹ |
| `latex_content` | `str` or `None` | æ­¥éª¤2è¾“å‡º | LaTeX å†…å®¹ï¼ˆå¦‚æœæ­¥éª¤2æ²¡æœ‰è·³è¿‡ï¼‰ |
| `user_original_input` | `str` or `None` | æ­¥éª¤0è¾“å‡º | åˆå¹¶æ–‡æ¡£å†…å®¹ï¼ˆå¦‚æœæ­¥éª¤2è·³è¿‡äº†ï¼Œåˆ™ä½¿ç”¨æ­¤è¾“å…¥ï¼‰ |
| `temperature` | `float` | APIå‚æ•° | æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤: 0.7ï¼‰ |
| `max_tokens` | `int` | APIå‚æ•° | æœ€å¤§tokenæ•°ï¼ˆé»˜è®¤: 4000ï¼‰ |
| `model` | `str` | APIå‚æ•° | æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼‰ |

### è¾“å…¥é€»è¾‘
**ä½ç½®**ï¼š`paper_generation_workflow.py` ç¬¬337-344è¡Œï¼ˆéæµå¼ï¼‰æˆ– ç¬¬867-878è¡Œï¼ˆæµå¼ï¼‰

```python
# å¦‚æœ LaTeX ç”Ÿæˆè¢«è·³è¿‡ï¼Œä½¿ç”¨ç”¨æˆ·åŸå§‹è¾“å…¥
latex_content = None
user_original_input = None

if not latex_result["is_skipped"]:
    latex_content = latex_result["file_content"]
else:
    user_original_input = user_document
```

### è¾“å‡º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `file_name` | `str` | æ–‡ä»¶åï¼Œå›ºå®šä¸º `requirements_checklist.md` |
| `file_content` | `str` | Markdown æ ¼å¼çš„éœ€æ±‚æ¸…å•å†…å®¹ |
| `usage` | `dict` | Tokenä½¿ç”¨æƒ…å†µ |

### Agentå®ç°ä½ç½®
**æ–‡ä»¶**ï¼š`app/core/agents/requirement_checklist_agent.py`
- `generate_requirement_checklist()` æ–¹æ³•

---

## ğŸŒ å‰ç«¯APIäº¤äº’

### APIæœåŠ¡å±‚
**æ–‡ä»¶**ï¼š`frontend/src/services/api.ts`

#### éæµå¼è°ƒç”¨
```typescript
// ä½ç½®ï¼šç¬¬340-397è¡Œ
workflowApi.execute(request: PaperGenerationWorkflowRequest & { pdfFile?: File; imageFiles?: File[] })
```

**è¯·æ±‚æ„å»º**ï¼ˆç¬¬343-376è¡Œï¼‰ï¼š
```typescript
const formData = new FormData();
formData.append('document', request.document);
formData.append('pdf_file', request.pdfFile);
formData.append('image_files', file); // å¤šå¼ å›¾ç‰‡
formData.append('session_id', request.session_id);
formData.append('user_info', request.user_info);
formData.append('has_outline', request.has_outline.toString());
formData.append('has_existing_tex', request.has_existing_tex.toString());
formData.append('temperature', request.temperature.toString());
formData.append('max_tokens', request.max_tokens.toString());
formData.append('model', request.model);
```

#### æµå¼è°ƒç”¨
```typescript
// ä½ç½®ï¼šç¬¬400-515è¡Œ
workflowApi.executeStream(
  request: PaperGenerationWorkflowRequest & { pdfFile?: File; imageFiles?: File[] },
  onChunk: (chunk: WorkflowProgressChunk) => void,
  onError?: (error: Error) => void,
  abortController?: AbortController
)
```

**SSEå¤„ç†**ï¼ˆç¬¬457-507è¡Œï¼‰ï¼š
```typescript
const reader = response.body?.getReader();
const decoder = new TextDecoder();
let buffer = '';

while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  buffer += decoder.decode(value, { stream: true });
  const lines = buffer.split('\n');
  buffer = lines.pop() || '';
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      onChunk(data); // è°ƒç”¨å›è°ƒå‡½æ•°
    }
  }
}
```

### ç»„ä»¶å±‚
**æ–‡ä»¶**ï¼š`frontend/src/components/Workflow.tsx`

#### è¡¨å•æäº¤å¤„ç†
**ä½ç½®**ï¼šç¬¬723-890è¡Œ

```typescript
const handleSubmit = async (e: React.FormEvent) => {
  // 1. éªŒè¯è¾“å…¥ï¼ˆç¬¬733-736è¡Œï¼‰
  if (!task.document.trim() && !task.pdfFile && task.imageFiles.length === 0) {
    // é”™è¯¯å¤„ç†
  }
  
  // 2. ç”ŸæˆsessionIdï¼ˆç¬¬738-754è¡Œï¼‰
  let sessionId = task.sessionId;
  if (!sessionId) {
    // ç”Ÿæˆæ–°çš„sessionId
  }
  
  // 3. è°ƒç”¨æµå¼APIï¼ˆç¬¬768-871è¡Œï¼‰
  await workflowApi.executeStream(
    {
      document: task.document || undefined,
      pdfFile: task.pdfFile || undefined,
      imageFiles: task.imageFiles.length > 0 ? task.imageFiles : undefined,
      session_id: sessionId,
      user_info: task.userInfo || undefined,
      has_outline: task.hasOutline,
      has_existing_tex: task.hasExistingTex,
      temperature: task.temperature,
      max_tokens: task.maxTokens,
      task_id: task.id,
    },
    (chunk: WorkflowProgressChunk) => {
      // å¤„ç†è¿›åº¦æ›´æ–°ï¼ˆç¬¬781-850è¡Œï¼‰
      if (chunk.type === 'progress') {
        // æ›´æ–°è¿›åº¦
      } else if (chunk.type === 'log') {
        // æ·»åŠ æ—¥å¿—
      } else if (chunk.type === 'result') {
        // è®¾ç½®æœ€ç»ˆç»“æœ
      }
    },
    (err) => {
      // é”™è¯¯å¤„ç†
    },
    abortController
  );
};
```

---

## ğŸ“Š æ•°æ®æµå›¾

```
å‰ç«¯ (Workflow.tsx)
  â†“ handleSubmit()
  â†“ workflowApi.executeStream()
  â†“ FormData (document, pdf_file, image_files, ...)
  â†“
åç«¯ API (workflow.py)
  â†“ execute_workflow_stream()
  â†“ [æ­¥éª¤0] PDF/å›¾ç‰‡å¤„ç†
  â†“ combined_document
  â†“
å·¥ä½œæµ (paper_generation_workflow.py)
  â†“ execute_stream()
  â†“ [æ­¥éª¤1] Paper Overview Agent
  â†“ paper_overview
  â†“ [æ­¥éª¤2] LaTeX Paper Generator Agent
  â†“ latex_content (æˆ– is_skipped)
  â†“ [æ­¥éª¤3] Requirement Checklist Agent
  â†“ requirements_checklist
  â†“
SSEæµå¼å“åº”
  â†“ WorkflowProgressChunk
  â†“ å‰ç«¯ onChunk å›è°ƒ
  â†“ æ›´æ–°UIçŠ¶æ€
```

---

## ğŸ” å…³é”®ä»£ç ç‰‡æ®µä½ç½®

### åç«¯

1. **PDFå¤„ç†å¹¶å‘é€»è¾‘**ï¼š
   - éæµå¼ï¼š`workflow.py` ç¬¬129-196è¡Œ
   - æµå¼ï¼š`workflow.py` ç¬¬703-720è¡Œ

2. **å›¾ç‰‡å¤„ç†å¹¶å‘é€»è¾‘**ï¼š
   - éæµå¼ï¼š`workflow.py` ç¬¬259-307è¡Œ
   - æµå¼ï¼š`workflow.py` ç¬¬787-876è¡Œ

3. **å·¥ä½œæµæ‰§è¡Œé¡ºåº**ï¼š
   - éæµå¼ï¼š`paper_generation_workflow.py` ç¬¬154è¡Œï¼ˆæ­¥éª¤1ï¼‰ã€ç¬¬206è¡Œï¼ˆæ­¥éª¤2ï¼‰ã€ç¬¬334è¡Œï¼ˆæ­¥éª¤3ï¼‰
   - æµå¼ï¼š`paper_generation_workflow.py` ç¬¬571è¡Œï¼ˆæ­¥éª¤1ï¼‰ã€ç¬¬655è¡Œï¼ˆæ­¥éª¤2ï¼‰ã€ç¬¬857è¡Œï¼ˆæ­¥éª¤3ï¼‰

### å‰ç«¯

1. **è¯·æ±‚æ„å»º**ï¼š`api.ts` ç¬¬407-443è¡Œ
2. **SSEè§£æ**ï¼š`api.ts` ç¬¬457-507è¡Œ
3. **è¿›åº¦æ›´æ–°å¤„ç†**ï¼š`Workflow.tsx` ç¬¬781-850è¡Œ

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶ä¸Šä¼ **ï¼šä½¿ç”¨ `FormData` å’Œ `multipart/form-data` æ ¼å¼
2. **æµå¼å“åº”**ï¼šä½¿ç”¨ Server-Sent Events (SSE) æ ¼å¼ï¼Œæ¯è¡Œä»¥ `data: ` å¼€å¤´
3. **å¹¶å‘æ§åˆ¶**ï¼šåç«¯æ£€æŸ¥ç”¨æˆ·æœ€å¤§å¹¶å‘æ•°é™åˆ¶ï¼ˆ`workflow.py` ç¬¬68-78è¡Œï¼‰
4. **Tokenç»“ç®—**ï¼šåœ¨æµç¨‹ç»“æŸæ—¶æ‰£é™¤ç”¨æˆ·ä½™é¢ï¼ˆ`workflow.py` ç¬¬390-407è¡Œï¼‰
5. **é”™è¯¯å¤„ç†**ï¼šå‰ç«¯ä½¿ç”¨ `AbortController` æ”¯æŒå–æ¶ˆæ“ä½œ

